\section{Konverzija iz HDF5 u CSV format}
\label{sec:DodatakIzvlacenje}

\begin{figure}[h]
\lstset{style=mystyle}
\begin{lstlisting}[language=Python, basicstyle=\footnotesize]
"""
Alexis Greenstreet (October 4, 2015) University of Wisconsin-Madison
"""
class Song:
    songCount = 0

    def __init__(self, songID):
        self.id = songID
        Song.songCount += 1
        self.albumName = None
        self.albumID = None
        self.artistID = None
        self.artistLatitude = None
        self.artistLocation = None
        self.artistLongitude = None
        self.artistName = None
        self.danceability = None
        self.duration = None
        self.genreList = []
        self.keySignature = None
        self.keySignatureConfidence = None
        self.lyrics = None
        self.loudness = None
        self.popularity = None
        self.tempo = None
        self.timeSignature = None
        self.timeSignatureConfidence = None
        self.title = None
        self.year = None
        self.artistFamiliarity = None #float
        self.artistHottnesss = None #float
        self.audioMd5 = None # string
        self.endOfFadeIn = None #float
        self.energy = None #float
        self.key = None #int
        self.keyConfidence = None #float
        self.mode = None # int
        self.modeConfidence = None #float
        self.release = None #string
        self.songHotttness = None #float
        self.songId = None #string
        self.startOfFadeOut = None #float
        self.trackId = None #string
        self.genre = None # list of strings
\end{lstlisting}
\label{code:ConvertToCSV}
\caption{Klasa kori\v{s}\'c{]ena za deserijalizaciju podataka.}}
\end{figure}

\begin{figure}[h]
\lstset{style=mystyle}
\begin{lstlisting}[language=Python, basicstyle=\footnotesize]
"""
Alexis Greenstreet (October 4, 2015) University of Wisconsin-Madison
"""
outputFile1 = open('SongCSV.csv', 'w')
csvRowString = ""

csvRowString = ("SongID,AlbumID, ...")
	csvAttributeList = re.split('\W+', csvRowString)
for i, v in enumerate(csvAttributeList):
    csvAttributeList[i] = csvAttributeList[i].lower()
outputFile1.write("SongNumber,");
outputFile1.write(csvRowString + "\n");
csvRowString = ""

#################################################
#Set the basedir here, the root directory from which the search
basedir = "/home/m/Documents/MillionSongSubset/data"
ext = ".h5"
#################################################

csvRowStringTotal = ""

for root, dirs, files in os.walk(basedir):
    files = glob.glob(os.path.join(root,'*'+ext))
    for f in files:
        print f

        songH5File = hdf5_getters.open_h5_file_read(f)
        song = Song(str(hdf5_getters.get_song_id(songH5File)))

        song.artistID = str(hdf5_getters.get_artist_id(songH5File))
        # Isto za ostala polja

        artistMbtags = np.array(hdf5_getters.get_artist_mbtags(songH5File))
        song.genre = ' | '.join(artistMbtags)

        csvRowString += str(song.songCount) + ","
        csvRowString += song.id + ","
        # Isto za ostala polja

        csvRowString += song.trackId + ","
        csvRowString += song.genre + "\n"
        csvRowStringTotal += csvRowString
        csvRowString = ""

        songH5File.close()

outputFile1.write(csvRowStringTotal)
outputFile1.close()
\end{lstlisting}
\label{code:ConvertToCSV}
\caption{Upro\v{s}\'c{}ena verzija programa kori\v{s}\'c{}enog za konvertovanje iz HDF5 u CSV format.}
\end{figure}
